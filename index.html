<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>PrenoBooking</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="Reserva y confirmación de citas de psicoterapia – PrenoBooking." />

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/vicentemoyanoas-boop/booking-preno-assets/main/favicon.png">

  <!-- Open Graph -->
  <meta property="og:title" content="Agenda aquí" />
  <meta property="og:description" content="Reserva y confirmación de citas de psicoterapia." />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://raw.githubusercontent.com/vicentemoyanoas-boop/booking-preno-assets/main/favicon.png" />

  <!-- Google Font (más profesional y liviana) -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --header-h: 72px;

      --page-bg: #f7f9fa;
      --header-bg: #ffffff;
      --border: rgba(0,0,0,.06);

      --brand: #1F4E79;
      --accent: #2E7D32;

      --text-main: #1c1c1c;
      --text-soft: rgba(0,0,0,.55);
    }

    html, body{
      height: 100%;
      margin: 0;
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background: var(--page-bg);
      color: var(--text-main);
      overflow: hidden;
      -webkit-font-smoothing: antialiased;
    }

    .wrap{
      height: 100svh;
      display: grid;
      grid-template-rows: var(--header-h) 1fr;
    }

    header{
      height: var(--header-h);
      display:flex;
      align-items:center;
      justify-content:center;
      background: var(--header-bg);
      border-bottom: 1px solid var(--border);
    }

    header img{
      width: clamp(160px, 18vw, 240px);
      height: auto;
      object-fit: contain;
    }

    .frame-area{
      position: relative;
      width: 100%;
      height: 100%;
      background: var(--page-bg);
    }

    iframe{
      width: 100%;
      height: 100%;
      border: 0;
      display: block;
      background: transparent;
    }

    /* Loader minimal */
    .loader{
      position:absolute;
      inset: 0;
      display:grid;
      place-items:center;
      background: rgba(247,249,250,.85);
      transition: opacity .25s ease;
      z-index: 2;
    }

    .loader.hidden{
      opacity: 0;
      pointer-events:none;
    }

    .spinner{
      width: 42px;
      height: 42px;
      border-radius: 50%;
      border: 4px solid rgba(31,78,121,.15);
      border-top-color: var(--brand);
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Fallback limpio */
    .fallback{
      position:absolute;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%);
      display:none;
      gap: 14px;
      align-items:center;
      padding: 14px 20px;
      border-radius: 14px;
      background: #ffffff;
      border: 1px solid var(--border);
      font-size: 14px;
      color: var(--text-soft);
      box-shadow: 0 20px 40px rgba(0,0,0,.06);
      z-index: 3;
    }

    .fallback.show{
      display:flex;
    }

    .btn{
      padding: 10px 16px;
      border-radius: 10px;
      text-decoration:none;
      font-weight: 600;
      font-size: 14px;
      color: white;
      background: var(--accent);
      transition: opacity .2s ease;
    }

    .btn:hover{
      opacity: .9;
    }

    @media (max-width: 520px){
      :root{ --header-h: 64px; }

      .fallback{
        flex-direction: column;
        text-align: center;
      }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <img
        src="https://raw.githubusercontent.com/vicentemoyanoas-boop/booking-preno-assets/main/logo.png"
        alt="PrenoBooking Logo"
        onerror="this.style.display='none'">
    </header>

    <div class="frame-area">
      <div id="loader" class="loader">
        <div class="spinner"></div>
      </div>

      <iframe
        id="bk-frame"
        title="Formulario de Reserva"
        src="https://script.google.com/macros/s/AKfycbx-CwMjzFw_sXZBgZmrhNw24pZ__8gnBYp9Q5vOjyGk_DoweKcPC6dwQuAvSBlZueSF7Q/exec"
        loading="eager"
        referrerpolicy="strict-origin-when-cross-origin">
      </iframe>

      <div id="fb" class="fallback">
        <span>No se pudo cargar aquí.</span>
        <a class="btn"
           href="https://script.google.com/macros/s/AKfycbx-CwMjzFw_sXZBgZmrhNw24pZ__8gnBYp9Q5vOjyGk_DoweKcPC6dwQuAvSBlZueSF7Q/exec"
           target="_top"
           rel="noopener noreferrer">
           Abrir directamente
        </a>
      </div>
    </div>
  </div>

  <script>
    const loader = document.getElementById('loader');
    const fb     = document.getElementById('fb');
    const frame  = document.getElementById('bk-frame');

    const hideLoader = () => loader.classList.add('hidden');

    const goDirect = () => {
      const url = frame?.src;
      if (!url) return;
      try { window.top.location.href = url; }
      catch { window.location.href = url; }
    };

    if (frame) {
      frame.addEventListener('load', hideLoader);
      frame.addEventListener('error', () => {
        fb.classList.add('show');
        hideLoader();
        goDirect();
      });
    }

    setTimeout(() => {
      if (!loader.classList.contains('hidden')) {
        fb.classList.add('show');
        hideLoader();
        goDirect();
      }
    }, 6000);
  </script>
</body>
</html>

